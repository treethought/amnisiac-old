<div class="container-fluid" id="now-playing-display">
    <div class="row">

        <div class="col-xs-4">
            <h2>Now Playing...</h2>
        </div>
    </div>

    <div class="row">
        <div class="youtube-player col-md-8" data-video="" data-autoplay="0" data-loop="1" id="youtube-player">
        </div>
    </div>

    <div class="row">
        <div class="col-lg">
            <div id='sc-player-div'>
            </div>
        </div>
    </div>
</div>

<div><button type="button" class="btn btn-link" id='toggle-player' data-toggle="button" aria-pressed="false" autocomplete="off">Hide Player</button> </div>



<div class="container-fluid feed-list col-md-8">

    <table class="table table-striped" id="feed-table">
        <thead>
            <tr>
                {# <th></th> #}
                <th></th>
                <th>Source</th>
                <th>Title</th>
                <th></th>

            </tr>
        </thead>
        <tbody>

        {% for item in items %}

            {% if 'Submission' in item.__class__.__name__ %}
              {% if 'you' in item.domain and item.video_id %}
                {% set sourceRowName = item.subreddit|lower() %}

                <tr class='reddit-row post-row {{sourceRowName}}-source'>

                  
                  <td class="col-xs-4 col-md-2 post-item reddit-post" height="100%" id="{{item.video_id}}"></td>

                  <td><img src="{{url_for('static', filename='icons/reddit.png')}}" width='40' height='40'><br>
                  {{item.subreddit}}</td>
                  
                  <td class="post-title" id="{{item.video_id}}-title">{{item.title}}</td>
                  {# <a href="{{item.url}}">{{item.title}}</a></td> #}
                  <td><button type="button" class="btn btn-link save-btn" id="{{item.video_id}}-save">Save</button></td>

                </tr>
              {% endif %}
            {% endif %} 

            {% if 'Resource' in item.__class__.__name__ %}
              {% set sourceRowName = item.user['username']|replace(' ','-')|lower() %}

                <tr class="sc-row post-row {{sourceRowName}}-source">

                  {# <th scope="row"> #}
                  <td class="col-xs-2 post-item sc-post" id="{{item.id}}"></td>

                  <td><img src="{{url_for('static', filename='icons/soundcloud.png')}}" width='40' height='40'><br>
                  {{item.user['username']}}</td>

                  <td class='post-title' id='{{item.id}}-title'>{{item.title}}</td>
                  <td><button type="button" class="btn btn-link save-btn" id="{{item.id}}-save">Save</button></td>

                </tr>
            {% endif %}

            {% endfor %} 

  

        </tbody>
    </table>

</div>


<script type="text/javascript">
$(function() {

    var btn = $('#toggle-player');
    var display = $('#now-playing-display');
    btn.hide();
    display.hide();
    btn.click(function() {
        display.toggle();
        if (display.is(':visible')) {
            btn.text('hide video player')
        } else {
            btn.text('show video player')
        }

    });




  var saveBtns = document.getElementsByClassName('save-btn');
  Array.from(saveBtns).forEach(function(elem, i) {
    var trackId = elem.id.split('-save')[0];
    var rawTitle = document.getElementById(trackId + '-title').innerHTML;
    console.log(rawTitle + ' -- ' + trackId);

    elem.addEventListener('click', function() {
      $.ajax({
        url: $SCRIPT_ROOT + '/save_item',
        type: 'POST',
        dataType: 'json',
        data:{track_id: trackId, raw_title: rawTitle},
      })
      .done(function() {
        console.log('sent ' + trackId)
        console.log("success");
      })
      .fail(function() {
        console.log("error");
      })
      .always(function() {
        console.log("complete");
      });
      
    });
  });


});

</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
<script src="{{url_for('static', filename='feed.js')}}"></script>


